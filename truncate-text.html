<link rel="import" href="../polymer/polymer.html">

<!--
Element providing solution to no problem in particular.

##### Example

    <truncate-text></truncate-text>

@element truncate-text
@blurb Element providing solution to no problem in particular.
@status alpha
@homepage http://juanpujol.github.io/truncate-text
-->
<polymer-element name="truncate-text" attributes="characters words word" noscript>

  <template>

    <content></content>

  </template>

  <script>

    Polymer('truncate-text', {
        ready: function () {
            if (this.words && !this.characters) {
                this.textContent = truncateByWords(this.textContent, this.words);
            } else {
                this.textContent = truncateByCharacters(this.textContent, this.characters);
            }
        }
    });

    var truncateByWords = function (input, words) {
        if (isNaN(words)) return input;
        if (words <= 0) return '';
        if (input) {
            var inputWords = input.split(/\s+/);
            if (inputWords.length > words) {
                input = inputWords.slice(0, words).join(' ') + '...';
            }
        }
        return input;
    };

    var truncateByCharacters = function (input, chars, breakOnWord) {
        if (isNaN(chars)) return input;
        if (chars <= 0) return '';
        if (input && input.length > chars) {
            input = input.trim().substring(0, chars);

            if (breakOnWord) {
                console.log('not breakOnWord')
                var lastspace = input.lastIndexOf(' ');
                //get last space
                if (lastspace !== -1) {
                    input = input.substr(0, lastspace);
                }
            } else {
                console.log('breakOnWord')
                while (input.charAt(input.length-1) === ' ') {
                    input = input.substr(0, input.length -1);
                }
            }

            console.log(input.length, chars)

            return input + '...';
        }
        return input;
    };

  </script>

</polymer-element>
